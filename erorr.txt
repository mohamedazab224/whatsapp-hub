Done in 876ms using pnpm v10.28.1
PS A:\dev\whatsapp-hub> pnpm audit --audit-level=high
┌─────────────────────┬────────────────────────────────────────────────────────┐
│ high                │ Next.js HTTP request deserialization can lead to DoS   │
│                     │ when using insecure React Server Components            │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Package             │ next                                                   │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Vulnerable versions │ >=16.0.0-beta.0 <16.0.11                               │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Patched versions    │ >=16.0.11                                              │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Paths               │ .>next                                                 │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ More info           │ https://github.com/advisories/GHSA-h25m-26qc-wcjf      │
└─────────────────────┴────────────────────────────────────────────────────────┘
3 vulnerabilities found
Severity: 2 moderate | 1 high
PS A:\dev\whatsapp-hub> pnpm audit --audit-level=moderate
┌─────────────────────┬────────────────────────────────────────────────────────┐
│ high                │ Next.js HTTP request deserialization can lead to DoS   │
│                     │ when using insecure React Server Components            │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Package             │ next                                                   │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Vulnerable versions │ >=16.0.0-beta.0 <16.0.11                               │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Patched versions    │ >=16.0.11                                              │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Paths               │ .>next                                                 │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ More info           │ https://github.com/advisories/GHSA-h25m-26qc-wcjf      │
└─────────────────────┴────────────────────────────────────────────────────────┘
┌─────────────────────┬────────────────────────────────────────────────────────┐
│ moderate            │ Next.js self-hosted applications vulnerable to DoS via │
│                     │ Image Optimizer remotePatterns configuration           │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Package             │ next                                                   │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Vulnerable versions │ >=15.6.0-canary.0 <16.1.5                              │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Patched versions    │ >=16.1.5                                               │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Paths               │ .>next                                                 │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ More info           │ https://github.com/advisories/GHSA-9g9p-9gw9-jx7f      │
└─────────────────────┴────────────────────────────────────────────────────────┘
┌─────────────────────┬────────────────────────────────────────────────────────┐
│ moderate            │ Next.js has Unbounded Memory Consumption via PPR       │
│                     │ Resume Endpoint                                        │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Package             │ next                                                   │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Vulnerable versions │ >=16.0.0-beta.0 <16.1.5                                │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Patched versions    │ >=16.1.5                                               │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ Paths               │ .>next                                                 │
├─────────────────────┼────────────────────────────────────────────────────────┤
│ More info           │ https://github.com/advisories/GHSA-5f7q-jpqc-wp7h      │
└─────────────────────┴────────────────────────────────────────────────────────┘
3 vulnerabilities found
Severity: 2 moderate | 1 high
PS A:\dev\whatsapp-hub> pnpm tsc --noEmit
app/actions/whatsapp.ts:31:64 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ ...; }, ... 5 more ..., "POST">', gave the following error.
    Argument of type '{ template_id: any; name: any; category: any; language: any; status: any; content: any; whatsapp_number_id: any; updated_at: string; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'template_id' does not exist in type 'never[]'.

31     const { error } = await supabase.from("message_templates").upsert(
                                                                  ~~~~~~


app/actions/whatsapp.ts:39:41 - error TS2339: Property 'id' does not exist on type 'never'.

39         whatsapp_number_id: phoneNumber.id,
                                           ~~

app/actions/whatsapp.ts:79:62 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_templates", never, "POST">', gave the following error.
    Argument of type '{ template_id: any; name: string; category: string; language: string; status: any; content: any[]; whatsapp_number_id: any; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_templates", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'template_id' does not exist in type 'never[]'.

79   const { error } = await supabase.from("message_templates").insert({
                                                                ~~~~~~


app/actions/whatsapp.ts:86:37 - error TS2339: Property 'id' does not exist on type 'never'.

86     whatsapp_number_id: phoneNumber.id,
                                       ~~

app/actions/whatsapp.ts:110:43 - error TS2339: Property 'id' does not exist on type 'never'.

110     .eq("whatsapp_number_id", phoneNumber.id)
                                              ~~

app/api/media/[id]/copy/route.ts:13:24 - error TS2339: Property 'storage_path' does not exist on type 'never'.

13   if (error || !media?.storage_path) {
                          ~~~~~~~~~~~~

app/api/media/[id]/copy/route.ts:18:99 - error TS2339: Property 'storage_path' does not exist on type 'never'.

18   const { data, error: signedError } = await supabase.storage.from("media").createSignedUrl(media.storage_path, 60 * 5)
                                                                                                     ~~~~~~~~~~~~

app/api/media/[id]/route.ts:18:13 - error TS2339: Property 'storage_path' does not exist on type 'never'.

18   if (media.storage_path) {
               ~~~~~~~~~~~~

app/api/media/[id]/route.ts:19:88 - error TS2339: Property 'storage_path' does not exist on type 'never'.

19     const { error: storageError } = await supabase.storage.from("media").remove([media.storage_path])
                                                                                          ~~~~~~~~~~~~

app/api/settings/ai/route.ts:9:62 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ ...; }, ... 5 more ..., "POST">', gave the following error.
    Argument of type '{ project_id: any; provider: any; model: any; system_prompt: any; temperature: any; max_tokens: any; timeout_ms: any; is_active: any; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'project_id' does not exist in type 'never[]'.

9   const { error } = await supabase.from("ai_configurations").upsert(
                                                               ~~~~~~


app/api/settings/integrations/route.ts:13:59 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ ...; }, ... 5 more ..., "POST">', gave the following error.
    Argument of type '{ project_id: string; type: any; is_active: any; config: { api_url: any; api_key: any; }; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'project_id' does not exist in type 'never[]'.

13     const { error } = await supabase.from("integrations").upsert(
                                                             ~~~~~~


app/api/templates/[id]/route.ts:19:62 - error TS2339: Property 'wa_template_code' does not exist on type 'never'.

19   const deleteResult = await deleteWhatsAppTemplate(template.wa_template_code)
                                                                ~~~~~~~~~~~~~~~~

app/api/templates/route.ts:59:30 - error TS2339: Property 'business_account_id' does not exist on type 'never'.

59   if (error || !phoneNumber?.business_account_id) {
                                ~~~~~~~~~~~~~~~~~~~

app/api/templates/route.ts:68:61 - error TS2339: Property 'business_account_id' does not exist on type 'never'.

68     metaResponse = await createWhatsAppTemplate(phoneNumber.business_account_id, {
                                                               ~~~~~~~~~~~~~~~~~~~

app/api/templates/route.ts:75:95 - error TS2339: Property 'id' does not exist on type 'never'.

75     logger.error("Failed to create template in WhatsApp", { error, phoneNumberId: phoneNumber.id })
                                                                                                 ~~

app/api/templates/route.ts:80:67 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "templates", never, "POST">', gave the following error.
    Argument of type '{ wa_template_name: any; wa_template_code: string; phone_number_id: any; status: string; category: any; language: any; preview_text: any; variables_count: number; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "templates", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'wa_template_name' does not exist in type 'never[]'.

80   const { error: insertError } = await supabase.from("templates").insert({
                                                                     ~~~~~~


app/api/templates/route.ts:83:34 - error TS2339: Property 'id' does not exist on type 'never'.

83     phone_number_id: phoneNumber.id,
                                    ~~

app/api/templates/route.ts:96:93 - error TS2339: Property 'id' does not exist on type 'never'.

96   logger.info("Template created", { templateId: metaResponse.id, phoneNumberId: phoneNumber.id })
                                                                                               ~~

app/api/templates/send-test/route.ts:27:35 - error TS2339: Property 'phone_number_id' does not exist on type 'never'.

27   if (phoneError || !phoneNumber?.phone_number_id) {
                                     ~~~~~~~~~~~~~~~

app/api/templates/send-test/route.ts:34:22 - error TS2339: Property 'wa_template_name' does not exist on type 'never'.

34       name: template.wa_template_name,
                        ~~~~~~~~~~~~~~~~

app/api/templates/send-test/route.ts:35:34 - error TS2339: Property 'language' does not exist on type 'never'.

35       language: { code: template.language },
                                    ~~~~~~~~

app/api/templates/send-test/route.ts:40:43 - error TS2339: Property 'phone_number_id' does not exist on type 'never'.

40     await sendWhatsAppMessage(phoneNumber.phone_number_id, payload.to, message)
                                             ~~~~~~~~~~~~~~~

app/api/templates/send-test/route.ts:42:28 - error TS2339: Property 'id' does not exist on type 'never'.

42       templateId: template.id,
                              ~~

app/api/templates/send-test/route.ts:48:88 - error TS2339: Property 'id' does not exist on type 'never'.

48     logger.error("Failed to send template test message", { error, templateId: template.id })
                                                                                          ~~

app/api/templates/sync/route.ts:36:30 - error TS2339: Property 'business_account_id' does not exist on type 'never'.

36   if (error || !phoneNumber?.business_account_id) {
                                ~~~~~~~~~~~~~~~~~~~

app/api/templates/sync/route.ts:43:56 - error TS2339: Property 'business_account_id' does not exist on type 'never'.

43     templates = await getWhatsAppTemplates(phoneNumber.business_account_id)
                                                          ~~~~~~~~~~~~~~~~~~~

app/api/templates/sync/route.ts:45:97 - error TS2339: Property 'id' does not exist on type 'never'.

45     logger.error("Failed to fetch templates from WhatsApp", { error, phoneNumberId: phoneNumber.id })
                                                                                                   ~~

app/api/templates/sync/route.ts:51:69 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ ...; }, ... 5 more ..., "POST">', gave the following error.
    Argument of type '{ wa_template_name: any; wa_template_code: any; phone_number_id: any; status: any; category: any; language: any; preview_text: any; variables_count: number; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'wa_template_name' does not exist in type 'never[]'.

51     const { error: upsertError } = await supabase.from("templates").upsert(
                                                                       ~~~~~~


app/api/templates/sync/route.ts:55:38 - error TS2339: Property 'id' does not exist on type 'never'.

55         phone_number_id: phoneNumber.id,
                                        ~~

app/data/media/page.tsx:113:85 - error TS2339: Property 'wa_id' does not exist on type '{ wa_id: any; }[]'.

113                       <div className="text-xs text-muted-foreground">{item.contact?.wa_id || "—"}</div>
                                                                                        ~~~~~

app/data/media/page.tsx:130:30 - error TS2304: Cannot find name 'Eye'.

130                             <Eye className="h-4 w-4" />
                                 ~~~

app/data/media/page.tsx:134:28 - error TS2304: Cannot find name 'Copy'.

134                           <Copy className="h-4 w-4" />
                               ~~~~

app/data/media/page.tsx:138:30 - error TS2552: Cannot find name 'Download'. Did you mean 'onload'?

138                             <Download className="h-4 w-4" />
                                 ~~~~~~~~

  node_modules/.pnpm/typescript@5.9.3/node_modules/typescript/lib/lib.dom.d.ts:38931:13
    38931 declare var onload: ((this: Window, ev: Event) => any) | null;
                      ~~~~~~
    'onload' is declared here.

app/data/media/page.tsx:142:28 - error TS2304: Cannot find name 'Trash2'.

142                           <Trash2 className="h-4 w-4" />
                               ~~~~~~

app/layout.tsx:41:34 - error TS2339: Property 'variable' does not exist on type 'NextFont'.

41       <body className={`${_geist.variable} font-sans antialiased`}>
                                    ~~~~~~~~

lib/ai-service.ts:17:28 - error TS2339: Property 'is_active' does not exist on type 'never'.

17     if (!config || !config.is_active) return null
                              ~~~~~~~~~

lib/env.server.ts:86:3 - error TS2322: Type '{ WHATSAPP_WEBHOOK_VERIFY_TOKEN: string; WHATSAPP_APP_SECRET: string; WEBHOOK_RATE_LIMIT_MAX?: string | undefined; WEBHOOK_RATE_LIMIT_WINDOW_SEC?: string | undefined; }' is not assignable to type '{ WHATSAPP_WEBHOOK_VERIFY_TOKEN: string; WHATSAPP_APP_SECRET: string; WEBHOOK_RATE_LIMIT_MAX: string; WEBHOOK_RATE_LIMIT_WINDOW_SEC: string; }'.
  Types of property 'WEBHOOK_RATE_LIMIT_MAX' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

86   cachedWebhookEnv = parseEnv(webhookEnvSchema, "webhook")
     ~~~~~~~~~~~~~~~~

lib/env.server.ts:87:3 - error TS2322: Type '{ WHATSAPP_WEBHOOK_VERIFY_TOKEN: string; WHATSAPP_APP_SECRET: string; WEBHOOK_RATE_LIMIT_MAX: string; WEBHOOK_RATE_LIMIT_WINDOW_SEC: string; } | null' is not assignable to type '{ WHATSAPP_WEBHOOK_VERIFY_TOKEN: string; WHATSAPP_APP_SECRET: string; WEBHOOK_RATE_LIMIT_MAX: string; WEBHOOK_RATE_LIMIT_WINDOW_SEC: string; }'.
  Type 'null' is not assignable to type '{ WHATSAPP_WEBHOOK_VERIFY_TOKEN: string; WHATSAPP_APP_SECRET: string; WEBHOOK_RATE_LIMIT_MAX: string; WEBHOOK_RATE_LIMIT_WINDOW_SEC: string; }'.

87   return cachedWebhookEnv
     ~~~~~~

lib/env.server.ts:92:3 - error TS2322: Type '{ WHATSAPP_ACCESS_TOKEN: string; WHATSAPP_API_VERSION?: string | undefined; }' is not assignable to type '{ WHATSAPP_ACCESS_TOKEN: string; WHATSAPP_API_VERSION: string; }'.
  Types of property 'WHATSAPP_API_VERSION' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

92   cachedWhatsappApiEnv = parseEnv(whatsappApiEnvSchema, "whatsapp-api")
     ~~~~~~~~~~~~~~~~~~~~

lib/env.server.ts:93:3 - error TS2322: Type '{ WHATSAPP_ACCESS_TOKEN: string; WHATSAPP_API_VERSION: string; } | null' is not assignable to type '{ WHATSAPP_ACCESS_TOKEN: string; WHATSAPP_API_VERSION: string; }'.
  Type 'null' is not assignable to type '{ WHATSAPP_ACCESS_TOKEN: string; WHATSAPP_API_VERSION: string; }'.

93   return cachedWhatsappApiEnv
     ~~~~~~

lib/env.server.ts:98:3 - error TS2322: Type '{ QUEUE_SECRET: string; QUEUE_RATE_LIMIT_MAX?: string | undefined; QUEUE_RATE_LIMIT_WINDOW_SEC?: string | undefined; }' is not assignable to type '{ QUEUE_SECRET: string; QUEUE_RATE_LIMIT_MAX: string; QUEUE_RATE_LIMIT_WINDOW_SEC: string; }'.
  Types of property 'QUEUE_RATE_LIMIT_MAX' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

98   cachedQueueEnv = parseEnv(queueEnvSchema, "queue")
     ~~~~~~~~~~~~~~

lib/env.server.ts:99:3 - error TS2322: Type '{ QUEUE_SECRET: string; QUEUE_RATE_LIMIT_MAX: string; QUEUE_RATE_LIMIT_WINDOW_SEC: string; } | null' is not assignable to type '{ QUEUE_SECRET: string; QUEUE_RATE_LIMIT_MAX: string; QUEUE_RATE_LIMIT_WINDOW_SEC: string; }'.
  Type 'null' is not assignable to type '{ QUEUE_SECRET: string; QUEUE_RATE_LIMIT_MAX: string; QUEUE_RATE_LIMIT_WINDOW_SEC: string; }'.

99   return cachedQueueEnv
     ~~~~~~

lib/env.server.ts:104:3 - error TS2322: Type '{ LOG_LEVEL?: "debug" | "info" | "warn" | "error" | undefined; }' is not assignable to type '{ LOG_LEVEL: "debug" | "info" | "warn" | "error"; }'.
  Types of property 'LOG_LEVEL' are incompatible.
    Type '"debug" | "info" | "warn" | "error" | undefined' is not assignable to type '"debug" | "info" | "warn" | "error"'.
      Type 'undefined' is not assignable to type '"debug" | "info" | "warn" | "error"'.

104   cachedLogEnv = parseEnv(logEnvSchema, "logger")
      ~~~~~~~~~~~~

lib/env.server.ts:105:3 - error TS2322: Type '{ LOG_LEVEL: "debug" | "info" | "warn" | "error"; } | null' is not assignable to type '{ LOG_LEVEL: "debug" | "info" | "warn" | "error"; }'.
  Type 'null' is not assignable to type '{ LOG_LEVEL: "debug" | "info" | "warn" | "error"; }'.

105   return cachedLogEnv
      ~~~~~~

lib/message-queue.ts:20:57 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_jobs", never, "POST">', gave the following error.
    Argument of type '{ type: string; status: string; payload: AiJobPayload; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_jobs", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'type' does not exist in type 'never[]'.

20   const { error } = await supabase.from("message_jobs").insert({
                                                           ~~~~~~


lib/message-queue.ts:50:25 - error TS2339: Property 'payload' does not exist on type 'never'.

50     const payload = job.payload as AiJobPayload
                           ~~~~~~~

lib/message-queue.ts:54:15 - error TS2345: Argument of type '{ status: string; }' is not assignable to parameter of type 'never'.

54       .update({ status: "processing" })
                 ~~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:55:21 - error TS2339: Property 'id' does not exist on type 'never'.

55       .eq("id", job.id)
                       ~~

lib/message-queue.ts:59:90 - error TS2339: Property 'id' does not exist on type 'never'.

59       logger.error("Failed to mark AI job as processing", { error: markError, jobId: job.id })
                                                                                            ~~

lib/message-queue.ts:74:52 - error TS2345: Argument of type '{ status: string; }' is not assignable to parameter of type 'never'.

74         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                      ~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:74:90 - error TS2339: Property 'id' does not exist on type 'never'.

74         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                                                            ~~

lib/message-queue.ts:88:52 - error TS2345: Argument of type '{ status: string; }' is not assignable to parameter of type 'never'.

88         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                      ~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:88:90 - error TS2339: Property 'id' does not exist on type 'never'.

88         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                                                            ~~

lib/message-queue.ts:95:52 - error TS2345: Argument of type '{ status: string; }' is not assignable to parameter of type 'never'.

95         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                      ~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:95:90 - error TS2339: Property 'id' does not exist on type 'never'.

95         await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                                                            ~~

lib/message-queue.ts:111:21 - error TS2339: Property 'direction' does not exist on type 'never'.

111             role: m.direction === "inbound" ? ("user" as const) : ("assistant" as const),
                        ~~~~~~~~~

lib/message-queue.ts:112:24 - error TS2339: Property 'body' does not exist on type 'never'.

112             content: m.body || "",
                           ~~~~

lib/message-queue.ts:124:41 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "messages", never, "POST">', gave the following error.
    Argument of type '{ contact_id: string; whatsapp_number_id: string; project_id: string; workflow_id: string; type: string; direction: string; body: string; metadata: { ai_generated: boolean; source: string; inbound_message_id: string; }; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "messages", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'contact_id' does not exist in type 'never[]'.

124         await supabase.from("messages").insert({
                                            ~~~~~~


lib/message-queue.ts:136:50 - error TS2345: Argument of type '{ status: string; }' is not assignable to parameter of type 'never'.

136       await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                     ~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:136:88 - error TS2339: Property 'id' does not exist on type 'never'.

136       await supabase.from("message_jobs").update({ status: "completed" }).eq("id", job.id)
                                                                                           ~~

lib/message-queue.ts:139:68 - error TS2339: Property 'id' does not exist on type 'never'.

139       logger.error("AI job processing failed", { error, jobId: job.id })
                                                                       ~~

lib/message-queue.ts:140:50 - error TS2345: Argument of type '{ status: string; error: string; }' is not assignable to parameter of type 'never'.

140       await supabase.from("message_jobs").update({ status: "failed", error: String(error) }).eq("id", job.id)
                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

lib/message-queue.ts:140:107 - error TS2339: Property 'id' does not exist on type 'never'.

140       await supabase.from("message_jobs").update({ status: "failed", error: String(error) }).eq("id", job.id)
                                                                                                              ~~

lib/supabase/server.ts:13:33 - error TS2339: Property 'getAll' does not exist on type 'Promise<ReadonlyRequestCookies>'.

13       getAll: () => cookieStore.getAll(),
                                   ~~~~~~

  lib/supabase/server.ts:13:33
    13       getAll: () => cookieStore.getAll(),
                                       ~~~~~~
    Did you forget to use 'await'?

lib/supabase/server.ts:16:23 - error TS2339: Property 'set' does not exist on type 'Promise<ReadonlyRequestCookies>'.

16           cookieStore.set(name, value, options)
                         ~~~

  lib/supabase/server.ts:16:23
    16           cookieStore.set(name, value, options)
                             ~~~
    Did you forget to use 'await'?

lib/workflow-engine.ts:43:73 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "webhook_events", never, "POST">', gave the following error.
    Argument of type '{ source: string; payload: any; raw_body: string; signature: string | null; event_hash: string; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "webhook_events", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'source' does not exist in type 'never[]'.

43   const { error: webhookError } = await supabase.from("webhook_events").insert({
                                                                           ~~~~~~


lib/workflow-engine.ts:63:47 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_statuses", never, "POST">', gave the following error.
    Argument of type '{ whatsapp_message_id: any; status: any; timestamp: number | null; recipient_id: any; conversation_id: any; pricing: any; metadata: any; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "message_statuses", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'whatsapp_message_id' does not exist in type 'never[]'.

63       await supabase.from("message_statuses").insert({
                                                 ~~~~~~


lib/workflow-engine.ts:94:8 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ ...; }, ... 5 more ..., "POST">', gave the following error.
    Argument of type '{ wa_id: any; name: any; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { onConflict?: string | undefined; ignoreDuplicates?: boolean | undefined; count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<...>', gave the following error.
    Object literal may only specify known properties, and 'wa_id' does not exist in type 'never[]'.

94       .upsert({ wa_id: msg.from, name: contact?.profile?.name }, { onConflict: "wa_id" })
          ~~~~~~


lib/workflow-engine.ts:112:40 - error TS2339: Property 'project_id' does not exist on type 'never'.

112       .eq("project_id", waNumberRecord.project_id)
                                           ~~~~~~~~~~

lib/workflow-engine.ts:118:92 - error TS2339: Property 'project_id' does not exist on type 'never'.

118       logger.warn("Workflow not found for project", { requestId, projectId: waNumberRecord.project_id })
                                                                                               ~~~~~~~~~~

lib/workflow-engine.ts:151:47 - error TS2339: Property 'id' does not exist on type 'never'.

151         const storagePath = `${waNumberRecord.id}/${msg.id}/${mediaId}.${extension}`
                                                  ~~

lib/workflow-engine.ts:178:8 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "messages", never, "POST">', gave the following error.
    Argument of type '{ whatsapp_message_id: any; contact_id: any; whatsapp_number_id: any; project_id: any; workflow_id: any; type: any; direction: string; body: any; metadata: any; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "messages", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'whatsapp_message_id' does not exist in type 'never[]'.

178       .insert({
           ~~~~~~


lib/workflow-engine.ts:180:34 - error TS2339: Property 'id' does not exist on type 'never'.

180         contact_id: contactData?.id,
                                     ~~

lib/workflow-engine.ts:181:44 - error TS2339: Property 'id' does not exist on type 'never'.

181         whatsapp_number_id: waNumberRecord.id,
                                               ~~

lib/workflow-engine.ts:182:36 - error TS2339: Property 'project_id' does not exist on type 'never'.

182         project_id: waNumberRecord.project_id,
                                       ~~~~~~~~~~

lib/workflow-engine.ts:183:31 - error TS2339: Property 'id' does not exist on type 'never'.

183         workflow_id: workflow.id,
                                  ~~

lib/workflow-engine.ts:196:42 - error TS2339: Property 'project_id' does not exist on type 'never'.

196         .eq("project_id", waNumberRecord.project_id)
                                             ~~~~~~~~~~

lib/workflow-engine.ts:201:37 - error TS2339: Property 'project_id' does not exist on type 'never'.

201           projectId: waNumberRecord.project_id,
                                        ~~~~~~~~~~

lib/workflow-engine.ts:202:32 - error TS2339: Property 'id' does not exist on type 'never'.

202           workflowId: workflow.id,
                                   ~~

lib/workflow-engine.ts:203:44 - error TS2339: Property 'id' does not exist on type 'never'.

203           whatsappNumberId: waNumberRecord.id,
                                               ~~

lib/workflow-engine.ts:204:35 - error TS2339: Property 'id' does not exist on type 'never'.

204           contactId: contactData?.id,
                                      ~~

lib/workflow-engine.ts:205:36 - error TS2339: Property 'id' does not exist on type 'never'.

205           messageId: messageRecord.id,
                                       ~~

lib/workflow-engine.ts:224:72 - error TS2769: No overload matches this call.
  Overload 1 of 2, '(values: never, options?: { count?: "exact" | "planned" | "estimated" | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "media_files", never, "POST">', gave the following error.
    Argument of type '{ project_id: any; whatsapp_number_id: any; workflow_id: any; contact_id: any; message_id: any; media_id: string; mime_type: string | undefined; file_size: number | undefined; storage_path: string | undefined; public_url: string | undefined; metadata: { ...; }; }' is not assignable to parameter of type 'never'.
  Overload 2 of 2, '(values: never[], options?: { count?: "exact" | "planned" | "estimated" | undefined; defaultToNull?: boolean | undefined; } | undefined): PostgrestFilterBuilder<{ PostgrestVersion: string; }, never, never, null, "media_files", never, "POST">', gave the following error.
    Object literal may only specify known properties, and 'project_id' does not exist in type 'never[]'.

224       const { error: mediaError } = await supabase.from("media_files").insert({
                                                                           ~~~~~~


lib/workflow-engine.ts:225:36 - error TS2339: Property 'project_id' does not exist on type 'never'.

225         project_id: waNumberRecord.project_id,
                                       ~~~~~~~~~~

lib/workflow-engine.ts:226:44 - error TS2339: Property 'id' does not exist on type 'never'.

226         whatsapp_number_id: waNumberRecord.id,
                                               ~~

lib/workflow-engine.ts:227:31 - error TS2339: Property 'id' does not exist on type 'never'.

227         workflow_id: workflow.id,
                                  ~~

lib/workflow-engine.ts:228:34 - error TS2339: Property 'id' does not exist on type 'never'.

228         contact_id: contactData?.id,
                                     ~~

lib/workflow-engine.ts:229:35 - error TS2339: Property 'id' does not exist on type 'never'.

229         message_id: messageRecord.id,
                                      ~~

lib/workflow-engine.ts:243:18 - error TS2339: Property 'ai_enabled' does not exist on type 'never'.

243     if (workflow.ai_enabled && msg.text?.body && waNumberRecord.project?.slug === "alazab-system" && contactData) {
                     ~~~~~~~~~~

lib/workflow-engine.ts:243:65 - error TS2339: Property 'project' does not exist on type 'never'.

243     if (workflow.ai_enabled && msg.text?.body && waNumberRecord.project?.slug === "alazab-system" && contactData) {
                                                                    ~~~~~~~

lib/workflow-engine.ts:246:33 - error TS2339: Property 'id' does not exist on type 'never'.

246         contact_id: contactData.id,
                                    ~~

lib/workflow-engine.ts:247:44 - error TS2339: Property 'id' does not exist on type 'never'.

247         whatsapp_number_id: waNumberRecord.id,
                                               ~~

lib/workflow-engine.ts:248:36 - error TS2339: Property 'project_id' does not exist on type 'never'.

248         project_id: waNumberRecord.project_id,
                                       ~~~~~~~~~~

lib/workflow-engine.ts:249:31 - error TS2339: Property 'id' does not exist on type 'never'.

249         workflow_id: workflow.id,
                                  ~~

lib/workflow-engine.ts:254:83 - error TS2339: Property 'project_id' does not exist on type 'never'.

254       logger.info("AI reply job enqueued", { requestId, projectId: waNumberRecord.project_id, workflowId: workflow.id })
                                                                                      ~~~~~~~~~~

lib/workflow-engine.ts:254:116 - error TS2339: Property 'id' does not exist on type 'never'.

254       logger.info("AI reply job enqueued", { requestId, projectId: waNumberRecord.project_id, workflowId: workflow.id })
                                                                                                                       ~~


Found 96 errors in 16 files.

Errors  Files
     5  app/actions/whatsapp.ts:31
     2  app/api/media/[id]/copy/route.ts:13
     2  app/api/media/[id]/route.ts:18
     1  app/api/settings/ai/route.ts:9
     1  app/api/settings/integrations/route.ts:13
     1  app/api/templates/[id]/route.ts:19
     6  app/api/templates/route.ts:59
     6  app/api/templates/send-test/route.ts:27
     5  app/api/templates/sync/route.ts:36
     5  app/data/media/page.tsx:113
     1  app/layout.tsx:41
     1  lib/ai-service.ts:17
     8  lib/env.server.ts:86
    19  lib/message-queue.ts:20
     2  lib/supabase/server.ts:13
    31  lib/workflow-engine.ts:43
PS A:\dev\whatsapp-hub> pnpm test

> alazab-whatsapp-hub@0.1.0 test A:\dev\whatsapp-hub
> tsx --test tests/*.test.ts

✔ parseBasicAuth parses basic credentials (54.9412ms)
✖ validateCredentials accepts configured users (7.1158ms)
✖ validateCredentials rejects unknown users (6.4716ms)
✔ shouldLog respects LOG_LEVEL (57.7531ms)
✔ verifyWebhookSignature returns true for a valid signature (2.3406ms)
✔ verifyWebhookSignature returns false for an invalid signature (0.4249ms)
ℹ tests 6
ℹ suites 0
ℹ pass 4
ℹ fail 2
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 530.8316

✖ failing tests:

test at tests\basic-auth.test.ts:2:2102
✖ validateCredentials accepts configured users (7.1158ms)
  Error: Invalid environment configuration (auth): AUTH_PASSWORD_SALT: Required; SESSION_SECRET: Required
      at parseEnv (A:\dev\whatsapp-hub\lib\env.server.ts:67:11)
      at getAuthEnv (A:\dev\whatsapp-hub\lib\env.server.ts:74:19)
      at getAllowedUsers (A:\dev\whatsapp-hub\lib\auth.ts:31:32)
      at validateCredentials (A:\dev\whatsapp-hub\lib\auth.ts:52:16)
      at TestContext.<anonymous> (A:\dev\whatsapp-hub\tests\basic-auth.test.ts:30:13)
      at async Test.run (node:internal/test_runner/test:1054:7)
      at async Test.processPendingSubtests (node:internal/test_runner/test:744:7)

test at tests\basic-auth.test.ts:2:2326
✖ validateCredentials rejects unknown users (6.4716ms)
  Error: Invalid environment configuration (auth): AUTH_PASSWORD_SALT: Required; SESSION_SECRET: Required
      at parseEnv (A:\dev\whatsapp-hub\lib\env.server.ts:67:11)
      at getAuthEnv (A:\dev\whatsapp-hub\lib\env.server.ts:74:19)
      at getAllowedUsers (A:\dev\whatsapp-hub\lib\auth.ts:31:32)
      at validateCredentials (A:\dev\whatsapp-hub\lib\auth.ts:52:16)
      at TestContext.<anonymous> (A:\dev\whatsapp-hub\tests\basic-auth.test.ts:36:16)
      at async Test.run (node:internal/test_runner/test:1054:7)
      at async Test.processPendingSubtests (node:internal/test_runner/test:744:7)
 ELIFECYCLE  Test failed. See above for more details.
PS A:\dev\whatsapp-hub> pnpm eslint . --max-warnings=0
'eslint' is not recognized as an internal or external command,
operable program or batch file.
 ERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL  Command "eslint" not found
